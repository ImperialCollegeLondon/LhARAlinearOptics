\section{Set-up and run}

\subsection*{Introduction}
This section summarises the steps needed to set-up and run
the linear optics simulation of the LhARA beam line.
A summary of the tasks that the software suite performs
will be documented in due course.
The code has been developed in python; python~3 is assumed.

\subsection*{Getting the code}
The linear optics package is maintained using the GitHub
version-control system.
The latest release can be downloaded from: \\
\begin{verbatim}
  \centerline{
    \href{https://github.com/ImperialCollegeLondon/LhARAlinearOptics.git}{https://github.com/ImperialCollegeLondon/LhARAlinearOptics.git}
  }
\end{verbatim}
  
\subsection*{Dependencies and required packages}
The linear optics code requires the following packages:
\begin{itemize}
  \item Python modules: \verb+scipy+ and \verb+matplotlib+. 
\end{itemize}
It may be convenient to run the package in a ``virtual environment''.
To set this up, after updating your python installation to python~3.9,
execute the following commands:
\begin{enumerate}
  \item \verb+python3 -m venv --system-site-packages venv+
    \begin{itemize}
      \item This creates the director \verb+venv+ that contains files
        related to the virtual environment.
    \end{itemize}
  \item \verb+source venv/bin/activate+
  \item \verb+python -m pip install pandas scipy matplotlib+
\end{enumerate}
To exit from the virtual environment, execute the command
\verb+deactivate+. 
The command \verb+source venv/bin/activate+ places you back
into the virtual environment.

The Imperial HEP linux cluster provides python 3.9.18 by default.

\subsection*{Unpacking the code, directories, and running the tests}
After downloading the package from GitHub, or cloning the repository,
you will find a ``\verb+README.md+'' file which provides some orientation
and instructions to run the code.
In particular, a \verb+bash+ script ``\verb+startup.bash+'' is
provided which:
\begin{itemize}
  \item Sets the ``\verb+LhARAOpticsPATH+'' environment variable
    so that the files that hold constants etc. required by the code
    can be located; and
  \item Adds ``\verb+01-Code+'' (see below) to the PYTHONPATH.
    The scripts in "\verb+02-Tests+" (see below) may then be run with
    the command "\verb+python 02-Tests/<filename>.py+".
\end{itemize}
Below the top directory, the directory structure in which the code is
presented is:
\begin{description}
  \item\verb+01-Code+: contains the python implementation as a
    series of modules.
    Each module contains a single class or a related set of methods.
  \item\verb+02-Tests+: contains self-contained test scripts that
    run the various methods and simulation packages defined in the
    code directory.
  \item\verb+11-Parameters+: contains the parameter set used to 
    specifiy the various beam lines presently implemented.
\end{description}
The instructions in the \verb+README.md+ file should be followed to set
up and run the code.

\subsection*{Running the code}
Execute "\verb+startup.bash+" from the top directory (i.e. run the
bash command "\verb+source startup.bash+").  This will:
\begin{itemize}
  \item Set up "\verb+LhARAOpticsPATH+"; and
  \item Add "\verb+01-Code+" to the \verb+PYTHONPATH+.
    The scripts in "\verb+02-Tests+" may then be run with the command
    "\verb+python 02-Tests/<filename>.py+"; 
  \item Example scripts are provided in "\verb+03-Scripts+'', these
    can be used first to ``\verb+Run+'' the simulation and then to
    ``\verb+Read+'' the data file produced.
    Example scripts are provided for the DRACO, LION, and LhARA
    Stage~1 beam lines.
\end{itemize}
